<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- css -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,300i,900,900i" rel="stylesheet">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <title>Calendar</title>
</head>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{{ url_for('static', filename='js/main.js') }}" defer></script>

<body>

<script>
function day_title(day_name) {
    document.write("<div class='c-cal__col'>" + day_name + "</div>");
  }

function fill_table(month, month_length, indexMonth) {
    day = 1;

    document.write("<div class='c-main c-main-" + indexMonth + "'>");
    document.write("<div class='c-cal__row'>");
    day_title("Sun");
    day_title("Mon");
    day_title("Tue");
    day_title("Wed");
    day_title("Thu");
    day_title("Fri");
    day_title("Sat");
    document.write("</div>");

    document.write("<div class='c-cal__row'>");
    for (var i = 1; i < start_day; i++) {
      if (start_day > 7) {
      } else {
        document.write("<div class='c-cal__cel'></div>");
      }
    }

    for (var i = start_day; i < 8; i++) {
      document.write(
        "<div data-day='2025-" +
          indexMonth +
          "-0" +
          day +
          "' class='c-cal__cel'><p>" +
          day +
          "</p></div>"
      );
      day++;
    }
    document.write("</div>");
    while (day <= month_length) {
      document.write("<div class='c-cal__row'>");
      for (var i = 1; i <= 7 && day <= month_length; i++) {
        if (day >= 1 && day <= 9) {
          document.write(
            "<div data-day='2025-" +
              indexMonth +
              "-0" +
              day +
              "' class='c-cal__cel'><p>" +
              day +
              "</p></div>"
          );
          day++;
        } else {
          document.write(
            "<div data-day='2025-" +
              indexMonth +
              "-" +
              day +
              "' class='c-cal__cel'><p>" +
              day +
              "</p></div>"
          );
          day++;
        }
      }
      document.write("</div>");
      start_day = i;
    }

    document.write("</div>");
  }
</script>
<header>
  <div class="wrapper">
    <div class="c-monthyear">
    <div class="c-month">
        <span id="prev" class="prev fa fa-angle-left" aria-hidden="true"></span>
        <div id="c-paginator">
          <span class="c-paginator__month">JANUARY</span>
          <span class="c-paginator__month">FEBRUARY</span>
          <span class="c-paginator__month">MARCH</span>
          <span class="c-paginator__month">APRIL</span>
          <span class="c-paginator__month">MAY</span>
          <span class="c-paginator__month">JUNE</span>
          <span class="c-paginator__month">JULY</span>
          <span class="c-paginator__month">AUGUST</span>
          <span class="c-paginator__month">SEPTEMBER</span>
          <span class="c-paginator__month">OCTOBER</span>
          <span class="c-paginator__month">NOVEMBER</span>
          <span class="c-paginator__month">DECEMBER</span>
        </div>
        <span id="next" class="next fa fa-angle-right" aria-hidden="true"></span>
      </div>
      <span class="c-paginator__year">2025</span>
    </div>
    <div class="c-sort">
      <a class="o-btn c-today__btn" href="javascript:;">TODAY</a>
    </div>
  </div>
</header>
<div class="wrapper">
  <div class="c-calendar">
    <div class="c-calendar__style c-aside">
      <a class="c-add o-btn js-event__add" href="javascript:;">add diary <span class="fa fa-plus"></span></a>
      <a class="o-btn js-event__detail" href="javascript:;">detail <span class="fa fa-eye"></span></a>
      <button type="button" class="o-btn js-diary__delete">delete <span class="fa fa-minus"></span>
</button>

      <div class="c-aside__day">
        <span class="c-aside__num"></span> <span class="c-aside__month"></span>
      </div>
      <div class="c-aside__eventList">
      </div>
    </div>
    <div class="c-cal__container c-calendar__style">
      <script>
      year = 2025;
      today = new Date("January 1, " + year);
      start_day = today.getDay() + 1;
      fill_table("January", 31, "01");
      fill_table("February", 28, "02");
      fill_table("March", 31, "03");
      fill_table("April", 30, "04");
      fill_table("May", 31, "05");
      fill_table("June", 30, "06");
      fill_table("July", 31, "07");
      fill_table("August", 31, "08");
      fill_table("September", 30, "09");
      fill_table("October", 31, "10");
      fill_table("November", 30, "11");
      fill_table("December", 31, "12");
      </script>
    </div>
  </div>

  <div class="c-event__creator c-calendar__style js-event__creator">
    <a href="javascript:;" class="o-btn js-event__close">CLOSE <span class="fa fa-close"></span></a>
    <form id="addDiary">
      <input placeholder="Diary Title" type="text" name="name">
      <input type="date" name="date">
      <textarea placeholder="How was your Day?" name="notes" cols="30" rows="10"></textarea>

    </form>
    <br>
    <a href="javascript:;" class="o-btn js-event__save">SAVE <span class="fa fa-save"></span></a>
  </div>
</div>

<script>
  // 현재 선택된 날짜를 저장할 변수
  let selectedDate = null;

  // 월 이름(영문) 배열: c-aside에 표시할 때 사용
  const MONTH_NAMES = [
    "JANUARY", "FEBRUARY", "MARCH", "APRIL",
    "MAY", "JUNE", "JULY", "AUGUST",
    "SEPTEMBER", "OCTOBER", "NOVEMBER", "DECEMBER"
  ];

  // 1) 달력 셀 클릭 시 해당 날짜를 선택
  document.addEventListener("click", function (e) {
    const cell = e.target.closest(".c-cal__cel");
    if (!cell) return;  // 달력 셀이 아니면 무시

    selectedDate = cell.dataset.day;  // 예: "2025-01-03"
    if (!selectedDate) return;

    // aside 날짜 표시 갱신
    const [y, m, d] = selectedDate.split("-");
    const numEl = document.querySelector(".c-aside__num");
    const monthEl = document.querySelector(".c-aside__month");

    if (numEl) numEl.textContent = d;
    if (monthEl) monthEl.textContent = MONTH_NAMES[parseInt(m, 10) - 1] || "";

    // 필요하면 여기에서 해당 날짜 일기 요약을 불러와 aside__eventList 갱신도 가능
    // (선택 날짜 변경 시 자동으로 상세 info 표시)
  });

  // 2) delete 버튼 클릭 시 선택된 날짜의 일기를 삭제
  document.addEventListener("click", function (e) {
    const btn = e.target.closest(".js-diary__delete");
    if (!btn) return;

    const ok = confirm(selectedDate + " Do you want to delete this diary?");
    if (!ok) return;

    fetch("/api/diary/" + selectedDate, {
      method: "DELETE"
    })
      .then(res => res.json())
      .then(data => {
        if (!data.ok) {
          alert(data.error || "error!");
          return;
        }
        const cell = document.querySelector(".c-cal__cel[data-day='" + selectedDate + "']");
        if (cell) {
          cell.classList.remove("has-diary");
        }

        const eventList = document.querySelector(".c-aside__eventList");
        if (eventList) eventList.innerHTML = "";

        alert("Delete Success!");
      })
  });
</script>

</body>
</html>